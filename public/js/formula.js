function addClass(e,t){var a=e.className.indexOf(t);return a>-1?e:(e.className=e.className+" "+t.trim(),e)}function removeClass(e,t){var a=e.className.indexOf(t);return 0>a?e:(e.className=e.className.replace(t.trim(),"").replace("  "," "),e)}function extend(e){function t(e){return e.addClass=function(t){return addClass(e,t)},e.removeClass=function(t){return removeClass(e,t)},e}return e.addClass&&e.removeClass?e:e instanceof NodeList?([].forEach.call(e,t),e):t(e)}function qq(e){return document.querySelectorAll(e)}function formula_sync_server(e,t){var a=new XMLHttpRequest;a.open("PUT",formula_sync_url),a.setRequestHeader("Content-Type","application/json; charset=utf-8"),a.onreadystatechange=function(){4==a.readyState&&200==a.status?(console.log("synced"),t&&t()):a.status&&200!=a.status&&console.log("sync seems to have failed")},a.send(JSON.stringify(e))}function formula_load_server(e){var t=new XMLHttpRequest;t.open("GET",formula_sync_url),t.onreadystatechange=function(){4==t.readyState&&200==t.status?(console.log("loaded from server"),e&&e(JSON.parse(t.responseText))):t.status&&200!=t.status&&console.log("server load fail")},t.send()}function formula_cache_init(){var e=location.hash.substr(1).split(":"),t=e[0],a=(e[1],{}),a=store.get("formula_progress")||a;formula_load_server(function(e){a.email&&a.email==t||(a={},a.email=t);for(var n in e)e[n]&&!a[n]&&(a[n]=e[n]);store.set("formula_progress",a),formula_sync_server(a)})}function formula_load_data(e){var t={},a={};return store&&(a=store.get("formula_progress")||a,t.last_cache_time=a.last_cache_time),[].forEach.call(e,function(e){var n="radio"==e.type?e.name:e.id||e.type,o=a[n];"checkbox"==e.type?t[n]=e.checked=o:"radio"==e.type?(t[n]=o,e.checked=o==e.value):o&&!e.value.trim()?(t[n]=e.value=o,e.onchange()):t[n]=e.value}),t}function formula_get_data(e){var t={},a={};return store&&(a=store.get("formula_progress")||a,t.last_cache_time=a.last_cache_time),[].forEach.call(e,function(e){var n="radio"==e.type?e.name:e.id||e.type,o=a[n];"checkbox"==e.type?t[n]=e.checked:"radio"==e.type?(e.checked=o==e.value,e.checked&&(t[n]=e.value)):t[n]=e.value}),t}function formula_cache_set(e){var t=store.get("formula_progress");if("radio"==e.type)t[e.name]=e.value||e.checked;else{var a="checkbox"==e.type?e.checked:e.value.trim();t[e.id||e.type]=a}store.set("formula_progress",t)}function formula_cache_data(e){if(!store)return console.warn("localStorage not supported, progress will not be saved.");var t=formula_get_data(e),a=store.get("formula_progress")||{};if(!(Date.now()-a.last_cache_time<1e3)){var n=!1;for(var o in t){var l=a[o],i=t[o];l!=i&&(n=!0,a[o]=t[o])}n&&(a.last_cache_time=Date.now(),store.set("formula_progress",a),formula_sync_server(a,function(){formula_notify&&formula_notify.notify("Changes saved.")}))}}function formula_set_validators(e){e=e||{};for(var t in e)formula_validators[t]=e[t]}function formula_validate_input(e){var t=!1,a=e.value.trim(),n=e.type,o=e.id,l=formula_validators;if(n in l)console.log("Validating "+n+"..."),console.log("With: ",l[n]),t=l[n](e,a);else{var i=n+"_"+o;i in l?(console.log("Validating type/id "+i+"..."),console.log("With: ",l[i]),t=l[i](e,a)):(console.log("Validating "+n+"..."),console.log("With: failover validator"),t=a.length>0)}return console.log(e.nextElementSibling&&e.nextElementSibling.textContent+" valid? "+t),t?e.addClass("valid"):e.removeClass("valid"),e.required?t:!0}function formula_inputs_valid(e){function t(e){return e===!0}return[].map.call(e,formula_validate_input).every(t)}function formula_page_is_valid(e){formula_cache_data(e),formula_animator.tilt()}function formula_page_is_invalid(){formula_animator.unTilt()}function formula_validate(e,t,a,n){this.go&&(clearTimeout(this.go),delete this.go),this.go=setTimeout(function(){a=a||formula_page_is_valid,n=n||formula_page_is_invalid,formula_inputs_valid(e)?a(e):n()},t||500)}function formula_get_pills(e){function t(e){return!e}var a=e.parentElement,n=a.getElementsByClassName("pill-left")[0],o=a.getElementsByClassName("pill-right")[0],l=[n,o];return l.every(t)?!1:l}function formula_value_with_pills(e){var t=formula_get_pills(e),a=e.value.trim();if(!t)return a;var n=t[0]&&t[0].children[0].textContent,o=t[1]&&t[1].children[0].textContent;return n&&0!=a.indexOf(n)&&(a=n+a),o&&a.indexOf(o)!=a.length-o.length&&(a+=o),a.trim()}function formula_form_setup_google_submit(e){e.action=formula_google_endpoint,e.target="dupe-frame",e.onsubmit=function(e){e.preventDefault(),e.stopPropagation()}}function formula_submit(){var e=(qq(".formula form")[0],qq(".formula form input, .formula form textarea")),t=formula_get_data(e);[].forEach.call(e,function(e){if(formula_get_pills(e)){{var a=e.id||e.type;t[a]}t[a]=formula_value_with_pills(e)}}),formula_sync_server(t),formula_animator.punchTicket()}function adjustPadding(){var e=qq(".input-group input~*, .input-group textarea~*, .input-group select~*"),t=15,a=0,n=t,o=t;[].forEach.call(e,function(e){var l=e.parentElement.children,i=l.length,r=l[i-1],s=l[0];s.type&&-1===["text","email","tel"].indexOf(s.type)||(/pill-left|glance/g.test(e.classList)&&(n+=e.offsetWidth),/pill-right/g.test(e.classList)&&(o+=e.offsetWidth),"LABEL"===e.nodeName&&(a=e.offsetWidth),e===r&&(console.log("STOP"),console.log(s),s.style.paddingLeft=n+"px",s.style.paddingRight=o+"px",s.style.width=a+"px",n=o=t))})}function closeWarning(e){var t=e.target.parentElement.parentElement;extend(t),t.addClass("dismissed")}function formula_setup_inputs(e){function t(){var e=this;0===e.value.length?e.removeClass("focus"):e.addClass("focus")}function a(){var e=this;e.previousElementSibling.addClass("focus"),e.previousElementSibling.focus()}console.log(e),extend(e),[].forEach.call(e,function(e){var n=e.nextElementSibling;n&&(n.onclick=a,e.onchange=e.onblur=t,e.value.length>0&&e.addClass("focus"))});var n=qq(".page");[].forEach.call(n,function(e){var t=[].slice.call(e.getElementsByTagName("input")),a=[].slice.call(e.getElementsByTagName("select")),n=[].slice.call(e.getElementsByTagName("textarea"));t=t.concat(n),t=t.concat(a),console.log(t);var o=function(){formula_validate(t,200)},l=function(){/checkbox|radio/.test(this.type)&&formula_cache_set(this),o()};[].forEach.call(t,function(e){e.onclick=l,e.onkeydown=function(e){return 13===e.keyCode?(e.preventDefault(),e.stopPropagation(),!1):(formula_animator.unTilt(),this.timeout&&clearTimeout(this.timeout)&&delete this.timeout,this.timeout=setTimeout(function(){o()},500),void 0)}})})}var formula_sync_url="/application-session/"+location.hash.substr(1).split(":")[1]||"",formula_animator=function(){function e(e,t,n){var o,l,i=[500,100,500];n instanceof Object&&(o=n.pre,l=n.post),i=a.calculateTimings(i),t instanceof Function?(i=l,l=o,o=t,t=e.nextElementSibling):o instanceof Function&&!l&&(l=o,o=null),t&&-1!==t.className.indexOf("page")&&(e.addClass("prev"),t.addClass("next"),e.style.opacity="1",a.reset(),a.formula.addClass("shuffle"),o&&o(),setTimeout(function(){t.addClass("current"),e.removeClass("current")},i[0]),setTimeout(function(){t.removeClass("next"),e.removeClass("prev"),a.formula.removeClass("shuffle"),l&&l()},i[1]),setTimeout(function(){e.style.opacity=""},i[2]))}function t(e){var t=document.createElement("STYLE").style.backgroundPosition="0% ";document.getElementById("formula-container").style.backgroundPosition=t+e+"%"}var a={};return a.formula=extend(qq(".formula")[0]),a.punchTicket=function(){var e=a.formula;e.removeClass("persp"),setTimeout(function(){e.addClass("punched")},500),setTimeout(function(){e.addClass("end")},3e3)},a.tilt=function(){var e=a.formula;e.addClass("persp")},a.unTilt=function(){var e=a.formula;e.removeClass("persp")},a.reset=function(){a.formula.removeClass("persp").removeClass("end").removeClass("punched").removeClass("shuffle").removeClass("reverse")},a.calculateTimings=function(e){var t=0;return e.map(function(e){return t+=e})},a.nextPage=function(a,n,o,l){n instanceof Function&&(l=n,n=null),e(a,n,{post:l}),t(o)},a.previousPage=function(n,o,l,i){o instanceof Function&&(i=o,o=null);var r=function(){a.formula.addClass("reverse")},s=function(){a.formula.removeClass("reverse"),i instanceof Function&&i()};e(n,o,{pre:r,post:s}),t(l)},a}(),formula_notify=function(){var e={};return e.notifyWindow=document.createElement("div"),extend(e.notifyWindow),e.notifyWindow.addClass("formula-notify-window"),e.notifyWindow.isAppended=!1,e.notify=function(t,a){e.notifyWindow.isAppended||document.body.appendChild(e.notifyWindow),e.notifyWindow.textContent=t,e.notifyWindow.style.display="block",setTimeout(function(){e.notifyWindow.style.opacity=1,setTimeout(function(){e.notifyWindow.style.opacity=0,setTimeout(function(){e.notifyWindow.style.display="none"},200)},a||2e3)},200)},e}(),formula_default_validators={email:function(e,t){return/\w+@[A-z0-9.\-]+/.test(t)},password:function(e,t){var a=/[_\-!@#$%^&* `~]/;return t.length>8&&/\d+/.test(t)&&a.test(t)},text_name:function(e,t){var a=t.split(/\s+/);return t.length>0&&2==a.length&&a[0].length>0&&a[1].length>0},tel:function(e,t){var a=t.split(/[-\s.]/);console.log(a);var n=a[0].replace(/[()]/g,"");return 3==a.length&&3==n.length&&!isNaN(parseInt(n))&&3==a[1].length&&!isNaN(parseInt(a[1]))&&4==a[2].length&&!isNaN(parseInt(a[2]))||/\d{10}/.test(t)&&!isNaN(parseInt(t))},text_year:function(e,t){return/\d{4}/.test(t)&&parseInt(t)>=2015},checkbox:function(e){var t=e.parentElement.children,a=!1;return[].forEach.call(t,function(e){e.checked&&(a=!0)}),a},radio:function(){return!0}},formula_validators=formula_default_validators;window.onload=function(){function e(e,a){if(a){var a=extend(a),o=a.getElementsByTagName("input"),l=a.getElementsByTagName("select"),i=a.getElementsByTagName("textarea");o=[].slice.call(o).concat([].slice.call(i)),o=[].slice.call(o).concat([].slice.call(l)),formula_animator.nextPage(e,a,n+=100/6,function(){formula_validate(o),o[0].focus()})}else formula_inputs_valid(t)?formula_submit():alert("Looks like something isn't quite right. Try going back and checking that all the textboxes are filled it, and all answers have little green check marks next to them.")}var t=qq(".formula input, .formula textarea, .formula select"),a=qq(".next-btn")[0],n=0;a.onclick=function(){var t=extend(qq(".page.current")[0]),a=t.nextElementSibling;e(t,a)};var o=qq(".back-btn");[].forEach.call(o,function(e){var t=extend(e.parentElement),a=t.previousElementSibling;if(a){var a=extend(a),o=a.getElementsByTagName("input"),l=a.getElementsByTagName("select"),i=a.getElementsByTagName("textarea");o=[].slice.call(o).concat([].slice.call(i)),o=[].slice.call(o).concat([].slice.call(l)),e.onclick=function(){formula_animator.previousPage(t,a,n-=100/6,function(){o[0].focus(),formula_validate(o)})}}else alert("There's nothing to go back to! This is the beginning!")}),formula_cache_init(),formula_setup_inputs(t,e),formula_load_data(t);var l=qq(".page.current input");formula_validate(l),adjustPadding(),window.onresize=adjustPadding;var i=qq('a[do*="close-warning"]')[0];i.onclick=closeWarning;var r=document.getElementById("resume-btn");filepicker.setKey("AG434Ppy3RES7VKbftrEnz"),r.onclick=function(){filepicker.pick({mimetypes:["text/plain","text/richtext","application/pdf","text/pdf"],container:"window",services:["COMPUTER","GMAIL","BOX","DROPBOX","GOOGLE_DRIVE","SKYDRIVE","EVERNOTE","CLOUDDRIVE"]},function(e){var t=qq(".page.current input");r.previousElementSibling.value=JSON.stringify(e),formula_validate(t)},function(e){console.log(e.toString())})};var s=qq(".thanks")[0];s.onclick=function(e){return e.preventDefault(),e.stopPropagation(),!1}};